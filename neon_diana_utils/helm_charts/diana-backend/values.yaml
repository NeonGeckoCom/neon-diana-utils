# This Chart will deploy Diana backend services, including RabbitMQ,
# HTTP Services with associated ingress and certificates, MQ Services,
# and configuration including secrets with keys and passwords.

# TODO: Update `domain`
domain: &domain 2023.us
# TODO: Update tag to `dev` or `latest`
mqServiceTag: &mq_tag dev

imagePullSecret: &pull_secret github-auth
configSecret: &config_secret diana-config
rmqSecret: &rmq_secret rmq-config

letsencrypt:
  sslSecret: &ssl_secret letsencrypt-staging
  server: https://acme-staging-v02.api.letsencrypt.org/directory
  email: developers@neon.ai
  # TODO: Update server and email to valid options
  # https://acme-v02.api.letsencrypt.org/directory

# Deploys RabbitMQ with specified auth credentials
rabbitmq:
  nameOverride: &name_rmq neon-rabbitmq
  fullnameOverride: *name_rmq
  persistence:
    enabled: false
  commonLabels:
    neon.project.name: diana
    neon.diana.service: *name_rmq
    neon.service.class: communication
  loadDefinition:
    enabled: true
    existingSecret: *rmq_secret
  extraConfiguration: |
    load_definitions = /app/load_definition.json

# Deploys HTTP Services
diana-http:
  domain: *domain
  ingress:
    tlsSecretName: *ssl_secret
    extraRules:
      - host: mqadmin
        serviceName: *name_rmq
        servicePort: 15672

# Deploys MQ Services
diana-mq:
  neon-api-proxy:
    configSecret: *config_secret
    image:
      tag: *mq_tag
  neon-brands-service:
    configSecret: *config_secret
    image:
      tag: *mq_tag
      pullSecret: *pull_secret
  neon-email-proxy:
    configSecret: *config_secret
    image:
      tag: *mq_tag
  neon-metrics-service:
    configSecret: *config_secret
    image:
      tag: *mq_tag
  neon-script-parser:
    configSecret: *config_secret
    image:
      tag: *mq_tag
      pullSecret: *pull_secret
